function imgerror(t){t.style.display="none"}function sortCounts(t){var a=[];for(var n in t)a.push([n,t[n]]);return a.sort(function(t,a){return a[1]-t[1]}),a}function switchGunBills(t){$("#bill-list").empty();var a="data/gunBills"+t+".json",n=[];$(".head-year").text(t),$.getJSON(a).done(function(t){function a(t,a){return pct=a/t*100,pct>95?95:Math.round(pct)}var e=0,r=[],s=[],i=[],o=[],l=[];$("#bill-list").html(""),$("#bill-groups").empty().html("Groups:<br/>"),$("#bill-parties").empty().html("Party:<br/>"),$("#bill-statuses").empty().html("Status:<br/>"),$("#bill-tags").empty().html("Tags:<br/>"),$.each(t,function(t,a){if("Native Americans"!=a["subjects-top-term"]&&"Animals"!=a["subjects-top-term"]&&"Agriculture and food"!=a["subjects-top-term"]&&"Economics and public finance"!=a["subjects-top-term"]&&"Education"!=a["subjects-top-term"]&&"Energy"!=a["subjects-top-term"]&&"Labor and employment"!=a["subjects-top-term"]&&"Private legislation"!=a["subjects-top-term"]&&"Water resources development"!=a["subjects-top-term"]){e++,r.push(a.status);var u=Date.parse(a.introduced),c="";c+="<div data-date='"+u+"'data-tag='"+a["subjects-top-term"]+"' class='bill'>",billNumberArray=a.number.split("-"),c+="     <span class='bill-header bill-number'>"+billNumberArray[0].toUpperCase()+"</span>";var p=a.introduced.split("-");if(c+="     <span class='bill-header bill-date'>"+monthNames[parseInt(p[1])-1]+" "+p[2]+", "+p[0]+"</span>",c+="     <span class='bill-tag'>"+a["subjects-top-term"]+"</span>",n.push(a["subjects-top-term"]),c+=a["short-title"]?"     <p class='bill-name'>"+a["short-title"]+"</p>":"     <p class='bill-name'>"+a.title+"</p>",c+="null"!=a.purpose?"<p class='bill-purpose'>"+a.purpose+"</p>":"<p class='bill-purpose'>No purpose specified</p>",c+="     <span class='bill-status'><strong>Status: </strong>"+a.status.join(" => ")+"</span>",console.log(a.lobbied),$.each(a.lobbied,function(t,a){o.push(a),l.push(a)}),c+="     <span class='sponsor-lobbied'><strong>Lobbied by: </strong> "+a.lobbied.join(", ")+"</span>",a.sponsor.last_name){c+="     <div class='bill-sponsor'>",c+="     <strong>Sponsor</strong>",a.sponsor.govtrack_id&&(c+="     <div class='mugBox clearFix","R"===a.sponsor.party?c+=" mugBoxR ":"D"===a.sponsor.party&&(c+=" mugBoxD "),c+="'><img class='bill-mug' src='https://www.govtrack.us/data/photos/"+a.sponsor.govtrack_id+"-100px.jpeg'/></div>"),"R"===a.sponsor.party?c+="<span class='circle republican'/>":"D"===a.sponsor.party&&(c+="<span class='circle democrat'/>"),i.push(a.sponsor.party),c+="          <span class='sponsor-name'>"+a.sponsor.title+". "+a.sponsor.first_name+" "+a.sponsor.last_name+" ("+a.sponsor.party+"-"+a.sponsor.state+")</span>",c+=a.sponsor.in_office===!0?"<span class='sponsor-status'>Status: In office</span>":"<span class='sponsor-status'>Status: Out of office</span>",c+="     </div>";var d={};d.party=a.sponsor.party,d.govtrack=a.sponsor.govtrack_id,d.last_name=a.sponsor.last_name,d.first_name=a.sponsor.first_name,d.in_office=a.sponsor.in_office,s.push(d)}else c+="     <div class='bill-sponsor'>",c+="     <strong>Sponsor</strong>",c+="          <span class='sponsor-name'>No sponsor information available</span>",c+="     </div>";c+="</div>",$("#bill-list").append(c)}}),$divs=$(".bill");var u=$divs.sort(function(t,a){return $(t).attr("data-date")-$(a).attr("data-date")});$("#bill-list").html(u);var c=_.countBy(n),p=[];$.each(c,function(t,a){p.push(t)}),p.sort(),$.each(p,function(t,a){$("#bill-tags").append("<span class='tag' data-tag='"+a+"'>"+a+"</span>")}),$(".tag").click(function(){var t=$(this).data("tag");$(this).toggleClass("selected-tag"),$(".bill").hide(),console.log(t),$("#bill-list").find("[data-tag='"+t+"']").toggleClass("selected-tag"),$(".selected-tag").show()});var d=_.countBy(l);console.log(d);var g=[];$.each(d,function(t,a){g.push(t)}),g.sort(),$.each(g,function(t,a){$("#bill-groups").append("<span class='tag' data-tag='"+a+"'>"+a+"</span>")}),console.log(i);var h=_.countBy(i);console.log(h);var m=[];$.each(h,function(t,a){m.push(t)}),m.sort(),$.each(m,function(t,a){$("#bill-parties").append("<span class='tag' data-tag='"+a+"'>"+a+"</span>")}),statusCounts=_.countBy(r),lobbiedCounts=_.countBy(o),sponsorCounts=_.countBy(s,function(t){return t.last_name}),console.log(sponsorCounts),statusCounts=sortCounts(statusCounts),h=sortCounts(h),lobbiedCounts=sortCounts(lobbiedCounts),sponsorCounts=sortCounts(sponsorCounts),console.log(sponsorCounts),$(".byOrg").empty().html("<h3>Organizations and the number of bills they lobbied</h3>");var f;$.each(lobbiedCounts,function(t,a){0===t&&(f=0),f+=parseInt(a[1])}),$.each(lobbiedCounts,function(t,n){var e;html="<div class='list-element'>",e=$.inArray(n[0],gunControlGroups)>=0?"gc":"gr",html+="     <span class='list-item'>"+n[0]+"</span>",html+="     <div class='bar-container'>",html+="          <div class='list-bar "+e+"' style='width:"+a(f,n[1])+"%'>&nbsp;</div><div class='bar-number'>"+n[1]+"</div>",html+="     </div>",html+="</div>",$(".byOrg").append(html)}),$(".byStatus").empty().html("<h3>Status breakdown of introduced gun-related legislation</h3>");var b;$.each(statusCounts,function(t,a){0===t&&(b=0),b+=parseInt(a[1])}),$.each(statusCounts,function(t,n){html="<div class='list-element'>",html+="     <span class='list-item'>"+n[0]+"</span>",html+="     <div class='bar-container'>",html+="          <div class='list-bar' style='width:"+a(f,n[1])+"%;background:#BF531B'>&nbsp;</div><div class='bar-number'>"+n[1]+"</div>",html+="     </div>",html+="</div>",$(".byStatus").append(html)}),$(".byParty").empty().html("<h3> Gun-related legislation introduced by party</h3>");var v;$.each(h,function(t,a){0===t&&(v=0),v+=parseInt(a[1]),console.log(v)}),$.each(h,function(t,n){switch(console.log(n),html="<div class='list-element'>",n[0]){case"R":html+="     <span class='list-item'>Republican</span>";break;case"D":html+="     <span class='list-item'>Democrat</span>";break;case"I":html+="     <span class='list-item'>Independent</span>";break;default:html+="     <span class='list-item'>Other</span>"}switch(html+="<div class='bar-container'>",n[0]){case"R":html+="<div class='list-bar republican' style='width:"+a(v,n[1])+"%'>&nbsp;</div><div class='bar-number'>"+n[1]+"</div>";break;case"D":html+="<div class='list-bar democrat' style='width:"+a(v,n[1])+"%'>&nbsp;</div><div class='bar-number'>"+n[1]+"</div>";break;default:html+="<div class='list-bar "+n[0]+"' style='width:"+a(v,n[1])+"%'>&nbsp;</div><div class='bar-number'>"+n[1]+"</div>"}html+="     </div>",html+="</div>",$(".byParty").append(html)})})}function buildOrgChart(t){console.log("--------------   In buildOrgChart()  --------------");var a={left:50,right:50,top:40,bottom:40},n=$("#orgChart").width(),e=500,t=d3.csvParse(t),r=d3.max(t,function(t){return parseInt(t["Violence Policy Center"])}),s=d3.min(t,function(t){return parseInt(t.year)}),i=d3.max(t,function(t){return parseInt(t.year)}),o=d3.scaleLinear().domain([s,i]).range([0,n]),l=d3.scaleLinear().domain([0,r]).range([e,0]),u=d3.axisBottom(o).tickFormat(d3.format("")),c=d3.axisLeft(l).tickFormat(d3.format(".2s")),p=d3.select("#orgChart").append("svg").attr("height",e+a.bottom).attr("width",n),d=p.append("g").attr("transform","translate("+a.left+",10)");d.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(u),d.append("g").attr("class","y axis").call(c);var g=t.columns.slice(1).map(function(a){return t.map(function(t){return{key:a,year:t.year,value:t[a]}})}),h=d.selectAll(".serie").data(g).enter().append("g").attr("class","serie");h.append("path").attr("class","line").style("stroke",function(t){return t[0].key}).attr("d",d3.line().x(function(t){return l(t.year)}).y(function(t){return l(t.value)}));var m=d3.line().defined(function(t){if(t.value>0)return t}).y(function(t){return l(t.value)}).x(function(t){return o(t.year)});d.append("path").attr("d",m(t)),d.selectAll(".dot").data(t.filter(function(t){if(t["Violence Policy Center"]>0)return t})).enter().append("circle").attr("class","dot").attr("cx",m.x()).attr("cy",m.y()).attr("r",7)}function buildTotalsChart(t,a){console.log("--------------   In buildTotalsChart()  --------------");var n=t+a,e=Math.round(a/n*100);$("#grBar").css("width",e+"%"),$("#gcBar").css("width",100-e+"%")}function buildTreeChart(t){function a(t){$("#treeChart").empty(),d3.select("#treeChart").selectAll(".node").data(t.leaves()).enter().append("div").attr("class","node").attr("title",function(t){return t.id+"\n"+i(t.value)}).style("left",function(t){return t.x0+"px"}).style("top",function(t){return t.y0+"px"}).style("width",function(t){return t.x1-t.x0+"px"}).style("height",function(t){return t.y1-t.y0+"px"}).style("background",function(t){var a=t.id.split(".");return"gr"===a[2]?s[1]:s[0]}).append("div").attr("class","node-label").text(function(t){var a=t.x1-t.x0,n=t.y1-t.y0;if(a>=80&&n>=80)return t.id.substring(t.id.lastIndexOf(".")+1).split(/(?=[A-Z][^A-Z])/g).join("\n")}).append("div").attr("class","node-value").text(function(t){var a=t.x1-t.x0,n=t.y1-t.y0;if(a>=80&&n>=80)return"$"+i(t.value)})}function n(n){console.log("switchData("+n+")"),u=d3.csvParse(t,function(t){var a=t.id.split(".");if(a[1]===n||1==a.length)return{id:t.id,value:+t.value}}),console.log(u),c=o(u).sum(function(t){return t.value}).sort(function(t,a){return a.height-t.height||a.value-t.value}),console.log(c),l(c),a(c)}console.log("--------------   In buildTreeChart()  --------------");var e=$("#treeChart").width(),r=500,s=["#88C5F2","#E3C357"],i=d3.format(",.0f"),o=(d3.scaleOrdinal().domain(["gc","gr"]).range(s),d3.stratify().parentId(function(t){return t.id.substring(0,t.id.lastIndexOf("."))})),l=d3.treemap().size([e,r]).padding(1).round(!0),u=d3.csvParse(t,function(t){var a=t.id.split(".");if(a[1]===firstYear||1==a.length)return{id:t.id,value:+t.value}}),c=o(u).sum(function(t){return t.value}).sort(function(t,a){return a.height-t.height||a.value-t.value});l(c),a(c),switchGunBills(firstYear),$(".year-list li").click(function(){var t=$(this).data("selectedyear");n(t),switchGunBills(t),console.log(t)})}function buildYearChart(t){console.log("--------------   In buildYearChart()  --------------");var a=$("#yearChart").width(),n=500,e=["#88C5F2","#E3C357"],r=d3.select("#yearChart").append("svg").attr("width",a).attr("height",n),s={top:5,right:0,bottom:17,left:25};a=a-s.left-s.right,n=n-s.top-s.bottom,group=r.append("g").attr("transform","translate("+s.left+","+s.top+")");var i=d3.scaleBand().rangeRound([0,a]).padding(.1).align(.1);i.domain(t.map(function(t){return t.Year}));var o=d3.scaleLinear().rangeRound([n,0]);o.domain([0,d3.max(t,function(t){return t.total})]).nice();var l=d3.scaleOrdinal().range([e[0],e[1]]);l.domain(["Gun Control","Gun Rights"]);var u=d3.stack(),c=["Gun Control","Gun Rights"];group.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+n+")").call(d3.axisBottom(i)),group.append("g").attr("class","axis axis--y").call(d3.axisLeft(o).ticks(10,"s").tickSize(a*-1)).append("text").attr("x",2).attr("y",o(o.ticks(10).pop())).attr("dy","0.35em"),group.selectAll(".serie").data(u.keys(c)(t)).enter().append("g").attr("class","serie").attr("fill",function(t){return l(t.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return i(t.data.Year)}).attr("y",function(t){return o(t[1])}).attr("height",function(t){return o(t[0])-o(t[1])}).attr("width",i.bandwidth());var p=group.selectAll(".legend").data(c.reverse()).enter().append("g").attr("class","legend").attr("transform",function(t,a){return"translate(0,"+20*a+")"}).style("font","10px sans-serif");p.append("rect").attr("x",30).attr("y",30).attr("width",18).attr("height",18).attr("fill",l),p.append("text").attr("x",58).attr("y",38).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t})}var firstYear="2000",monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],gunControlGroups=[],gunRightsGroups=[];$(document).ready(function(){$("#hero-gr").hide();var t=$("#hero-gc").height();$("#hero").height(t),$(window).resize(function(){t=$("#hero-gc").height(),$("#hero").height(t)}),$("#button-gc").click(function(){console.log("click"),$(".gr").removeClass("gr").addClass("gc"),$(".gr-dark").removeClass("gr-dark").addClass("gc-dark"),$("#hero-gr").fadeOut(),$("#hero-gc").fadeIn()}),$("#button-gr").click(function(){console.log("click"),$(".gc").removeClass("gc").addClass("gr"),$(".gc-dark").removeClass("gc-dark").addClass("gr-dark"),$("#hero-gc").fadeOut(),$("#hero-gr").fadeIn()}),$(".handle").click(function(){$(this).toggleClass("slideRight"),$(".gun-control").toggleClass("hide-gun-control"),$(".gun-rights").toggleClass("hide-gun-rights")});var a="data/gunOrgSpending.json",n=2e3,e=2016,r={},s={},o=[],l=[];for(i=n;i<=e;i++)$(".year-list").append("<li data-selectedYear="+i+">"+i+"</li>");$.getJSON(a).done(function(t){var a=t.spending[0].gunControl,u=t.spending[1].gunRights;for(i=n;i<=e;i++)$.each(a,function(t,a){$.each(a,function(t,a){o.push(a.name),gunControlGroups.push(a.name)})}),$.each(u,function(t,a){$.each(a,function(t,a){o.push(a.name),gunRightsGroups.push(a.name)})});gunControlGroups=_.uniqBy(gunControlGroups),gunRightsGroups=_.uniqBy(gunRightsGroups),console.log(gunRightsGroups),gunOrgCounts=_.countBy(o);var c=["year"];$.each(gunOrgCounts,function(t,a){c.push(t)});var p=c+"\n",d="id,value\n";for(d+="flare,\n",i=n;i<=e;i++){yearArray=[i.toString()],d+="flare."+i.toString()+",\n";var g=!1,h=!1;$.each(t.spending,function(t,a){0===t&&(group="gc",g||(d+="flare."+i.toString()+"."+group+",\n",$.each(a.gunControl[i.toString()],function(t,a){var n=$.inArray(a.name,c);parseInt(a.expenditures)>0&&(yearArray[n]=a.expenditures),d+="flare."+i.toString()+"."+group+"."+a.name+","+a.expenditures+"\n"}),g=!0))}),$.each(t.spending,function(t,a){1===t&&(group="gr",h||(d+="flare."+i.toString()+"."+group+",\n",$.each(a.gunRights[i.toString()],function(t,a){var n=$.inArray(a.name,c);parseInt(a.expenditures)>0&&(yearArray[n]=a.expenditures),d+="flare."+i.toString()+"."+group+"."+a.name+","+a.expenditures+"\n"}),h=!0))}),p+=yearArray+"\n"}for(i=n;i<=e;i++)mainYear={},mainYear.Year=i,s[i]=0,r[i]=0,u[i.toString()].forEach(function(t){s[i.toString()]+=parseInt(t.expenditures)}),a[i.toString()].forEach(function(t){r[i.toString()]+=parseInt(t.expenditures)}),mainYear["Gun Control"]=r[i.toString()],mainYear["Gun Rights"]=s[i.toString()],mainYear.total=parseInt(r[i.toString()])+parseInt(s[i.toString()]),l.push(mainYear);var m=0,f=0;$.each(l,function(t,a){m+=a["Gun Control"],f+=a["Gun Rights"]}),buildTotalsChart(m,f),buildYearChart(l),buildOrgChart(p),buildTreeChart(d)});var u=new Date,c=u.getFullYear();$(".copyright").text(c)});
//# sourceMappingURL=scripts-bundle.js.map
