function imgerror(t){t.style.display="none"}function sortCounts(t){var a=[];for(var r in t)a.push([r,t[r]]);return a.sort(function(t,a){return a[1]-t[1]}),a}function switchGunBills(t){$("#bill-list").empty();var a="data/gunBills"+t+".json",r=[];$(".head-year").text(t),$.getJSON(a).done(function(t){function a(t,a){return pct=a/t*100,pct>95?95:Math.round(pct)}var s=0,e=[],n=[],o=[],i=[],l=[];$("#bill-list").html(""),$("#bill-groups").empty().html("<strong>Groups:</strong><br/>"),$("#bill-parties").empty().html("<strong>Party:</strong><br/>"),$("#bill-statuses").empty().html("<strong>Status:</strong><br/>"),$("#bill-tags").empty().html("<strong>Tags:</strong><br/>"),$.each(t,function(t,a){if("Native Americans"!=a["subjects-top-term"]&&"Animals"!=a["subjects-top-term"]&&"Agriculture and food"!=a["subjects-top-term"]&&"Economics and public finance"!=a["subjects-top-term"]&&"Education"!=a["subjects-top-term"]&&"Energy"!=a["subjects-top-term"]&&"Labor and employment"!=a["subjects-top-term"]&&"Private legislation"!=a["subjects-top-term"]&&"Water resources development"!=a["subjects-top-term"]){s++,e.push(a.status);var u=Date.parse(a.introduced),c="";c+="<div data-date='"+u+"'data-tag='"+a["subjects-top-term"]+"' data-groups='"+a.lobbied+"'  data-party='"+a.sponsor.party+"' class='bill'>",billNumberArray=a.number.split("-"),c+="     <span class='bill-header bill-number'>"+billNumberArray[0].toUpperCase()+"</span>";var d=a.introduced.split("-");if(c+="     <span class='bill-header bill-date'>"+monthNames[parseInt(d[1])-1]+" "+d[2]+", "+d[0]+"</span>",c+="     <span class='bill-tag'>"+a["subjects-top-term"]+"</span>",r.push(a["subjects-top-term"]),c+=a["short-title"]?"     <p class='bill-name'>"+a["short-title"]+"</p>":"     <p class='bill-name'>"+a.title+"</p>",c+="null"!=a.purpose?"<p class='bill-purpose'>"+a.purpose+"</p>":"<p class='bill-purpose'>No purpose specified</p>",c+="     <span class='bill-status'><strong>Status: </strong>"+a.status.join(" => ")+"</span>",$.each(a.lobbied,function(t,a){i.push(a),l.push(a)}),c+="     <span class='sponsor-lobbied'><strong>Lobbied by: </strong> "+a.lobbied.join(", ")+"</span>",a.sponsor.last_name){"R"===a.sponsor.party?c+="     <div class='bill-sponsor republican'>":"D"===a.sponsor.party&&(c+="     <div class='bill-sponsor democrat'>"),c+="     <strong>Sponsor</strong>",a.sponsor.govtrack_id&&(c+="     <div class='mugBox clearFix","R"===a.sponsor.party?c+=" mugBoxR ":"D"===a.sponsor.party&&(c+=" mugBoxD "),c+="'><img class='bill-mug' src='https://www.govtrack.us/data/photos/"+a.sponsor.govtrack_id+"-100px.jpeg'/></div>"),o.push(a.sponsor.party),c+="          <span class='sponsor-name'>"+a.sponsor.title+". "+a.sponsor.first_name+" "+a.sponsor.last_name+" ("+a.sponsor.party+"-"+a.sponsor.state+")</span>",c+=a.sponsor.in_office===!0?"<span class='sponsor-status'>Status: In office</span>":"<span class='sponsor-status'>Status: Out of office</span>",c+="     </div>";var p={};p.party=a.sponsor.party,p.govtrack=a.sponsor.govtrack_id,p.last_name=a.sponsor.last_name,p.first_name=a.sponsor.first_name,p.in_office=a.sponsor.in_office,n.push(p)}else c+="     <div class='bill-sponsor'>",c+="     <strong>Sponsor</strong>",c+="          <span class='sponsor-name'>No sponsor information available</span>",c+="     </div>";c+="</div>",$("#bill-list").append(c)}}),$divs=$(".bill");var u=$divs.sort(function(t,a){return $(t).attr("data-date")-$(a).attr("data-date")});$("#bill-list").html(u);var c=_.countBy(r),d=[];$.each(c,function(t,a){d.push(t)}),d.sort(),$.each(d,function(t,a){$("#bill-tags").append("<span class='tag' data-tag='"+a+"'>"+a+"</span>")});var p=_.countBy(l),g=[];$.each(p,function(t,a){g.push(t)}),g.sort(),$.each(g,function(t,a){$("#bill-groups").append("<span class='tag' data-group='"+a+"'>"+a+"</span>")});var h=_.countBy(o),m=[];$.each(h,function(t,a){m.push(t)}),m.sort(),$.each(m,function(t,a){$("#bill-parties").append("<span class='tag' data-party='"+a+"'>"+a+"</span>")}),$(".tag").click(function(){if(console.log("Clicked a tag."),$(this).data("tag")){var t=$(this).data("tag");$(this).toggleClass("selected-tag"),$(".bill").hide(),$("#bill-list").find("[data-tag='"+t+"']").toggleClass("selected-tag"),$(".selected-tag").show()}if($(this).data("party")){console.log($(this).data("party"));var t=$(this).data("party");$(this).toggleClass("selected-tag"),$(".bill").hide(),$("#bill-list").find("[data-party='"+t+"']").toggleClass("selected-tag"),$(".selected-tag").show()}if($(this).data("group")){console.log($(this).data("group"));var t=$(this).data("group");$(this).toggleClass("selected-tag"),$(".bill").hide(),$("#bill-list").find("[data-groups*='"+t+"']").toggleClass("selected-tag"),$(".selected-tag").show()}}),statusCounts=_.countBy(e),lobbiedCounts=_.countBy(i),sponsorCounts=_.countBy(n,function(t){return t.last_name}),statusCounts=sortCounts(statusCounts),h=sortCounts(h),lobbiedCounts=sortCounts(lobbiedCounts),sponsorCounts=sortCounts(sponsorCounts),$(".byOrg").empty().html("<h3>Organizations and the number of bills they lobbied</h3>");var f=lobbiedCounts[0][1];$.each(lobbiedCounts,function(t,r){var s;html="<div class='list-element'>",s=$.inArray(r[0],gunControlGroups)>=0?"gc":"gr",html+="     <span class='list-item'>"+r[0]+"</span>",html+="     <div class='bar-container'>",html+="          <div class='list-bar "+s+"' style='width:"+a(f,r[1])+"%'>&nbsp;</div><div class='bar-number'>"+r[1]+"</div>",html+="     </div>",html+="</div>",$(".byOrg").append(html)}),$(".byStatus").empty().html("<h3>Status breakdown of introduced gun-related legislation</h3>");var b=statusCounts[0][1];$.each(statusCounts,function(t,r){html="<div class='list-element'>",html+="     <span class='list-item'>"+r[0]+"</span>",html+="     <div class='bar-container'>",html+="          <div class='list-bar' style='width:"+a(b,r[1])+"%;background:#BF531B'>&nbsp;</div><div class='bar-number'>"+r[1]+"</div>",html+="     </div>",html+="</div>",$(".byStatus").append(html)}),$(".byParty").empty().html("<h3> Gun-related legislation introduced by party</h3>");var v=h[0][1];$.each(h,function(t,r){switch(html="<div class='list-element'>",r[0]){case"R":html+="     <span class='list-item'>Republican</span>";break;case"D":html+="     <span class='list-item'>Democrat</span>";break;case"I":html+="     <span class='list-item'>Independent</span>";break;default:html+="     <span class='list-item'>Other</span>"}switch(html+="<div class='bar-container'>",r[0]){case"R":html+="<div class='list-bar republican' style='width:"+a(v,r[1])+"%'>&nbsp;</div><div class='bar-number'>"+r[1]+"</div>";break;case"D":html+="<div class='list-bar democrat' style='width:"+a(v,r[1])+"%'>&nbsp;</div><div class='bar-number'>"+r[1]+"</div>";break;default:html+="<div class='list-bar "+r[0]+"' style='width:"+a(v,r[1])+"%'>&nbsp;</div><div class='bar-number'>"+r[1]+"</div>"}html+="     </div>",html+="</div>",$(".byParty").append(html)})})}function buildOrgChart(t){console.log("--------------   In buildOrgChart()  --------------");var a={left:50,right:50,top:40,bottom:40},r=$("#orgChart").width(),s=500,t=d3.csvParse(t),e=d3.max(t,function(t){return parseInt(t["Violence Policy Center"])}),n=d3.min(t,function(t){return parseInt(t.year)}),o=d3.max(t,function(t){return parseInt(t.year)}),i=d3.scaleLinear().domain([n,o]).range([0,r]),l=d3.scaleLinear().domain([0,e]).range([s,0]),u=d3.axisBottom(i).tickFormat(d3.format("")),c=d3.axisLeft(l).tickFormat(d3.format(".2s")),d=d3.select("#orgChart").append("svg").attr("height",s+a.bottom).attr("width",r),p=d.append("g").attr("transform","translate("+a.left+",10)");p.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(u),p.append("g").attr("class","y axis").call(c);var g=t.columns.slice(1).map(function(a){return t.map(function(t){return{key:a,year:t.year,value:t[a]}})}),h=p.selectAll(".serie").data(g).enter().append("g").attr("class","serie");h.append("path").attr("class","line").style("stroke",function(t){return t[0].key}).attr("d",d3.line().x(function(t){return l(t.year)}).y(function(t){return l(t.value)}));var m=d3.line().defined(function(t){if(t.value>0)return t}).y(function(t){return l(t.value)}).x(function(t){return i(t.year)});p.append("path").attr("d",m(t)),p.selectAll(".dot").data(t.filter(function(t){if(t["Violence Policy Center"]>0)return t})).enter().append("circle").attr("class","dot").attr("cx",m.x()).attr("cy",m.y()).attr("r",7)}function buildTotalsChart(t,a){console.log("--------------   In buildTotalsChart()  --------------");var r=t+a,s=Math.round(a/r*100);$("#grBar").css("width",s+"%"),$("#gcBar").css("width",100-s+"%")}function buildTreeChart(t){function a(t){$("#treeChart").empty(),d3.select("#treeChart").selectAll(".node").data(t.leaves()).enter().append("div").attr("class","node").attr("group",function(t){var a=t.id,r=a.split(/\r?\n|\r/),s=r[0].substring(r[0].lastIndexOf(".")+1);return s}).attr("expenditure",function(t){return t.value}).style("left",function(t){return t.x0+"px"}).style("top",function(t){return t.y0+"px"}).style("width",function(t){return t.x1-t.x0+"px"}).style("height",function(t){return t.y1-t.y0+"px"}).style("background",function(t){var a=t.id.split(".");return"gr"===a[2]?n[1]:n[0]}).on("mouseover",function(t){console.log("mouseover");var a="<span class='callout-label'>"+$(this).attr("group")+"</span>";a+="$"+o($(this).attr("expenditure")),$("#callout-treemap").html(a).show()}).on("mouseout",function(){console.log("mouseout"),$("#callout-treemap").hide()}).append("div").attr("class","node-label").text(function(t){var a=t.x1-t.x0,r=t.y1-t.y0;if(a>=80&&r>=80)return t.id.substring(t.id.lastIndexOf(".")+1).split(/(?=[A-Z][^A-Z])/g).join("\n")}).append("div").attr("class","node-value").text(function(t){var a=t.x1-t.x0,r=t.y1-t.y0;if(a>=80&&r>=80)return"$"+o(t.value)})}function r(r){console.log("switchData("+r+")");var s=d3.csvParse(t,function(t){var a=t.id.split(".");if(a[1]===r.toString()||1==a.length)return{id:t.id,value:+t.value}});console.log(s);var e=i(s).sum(function(t){return t.value}).sort(function(t,a){return a.height-t.height||a.value-t.value});console.log(e),l(e),a(e)}d3.select("body").append("div").attr("class","tooltip").style("opacity",0);console.log("--------------   In buildTreeChart()  --------------");var s=$("#treeChart").width(),e=500,n=["#88C5F2","#E3C357"],o=d3.format(",.0f"),i=(d3.scaleOrdinal().domain(["gc","gr"]).range(n),d3.stratify().parentId(function(t){return t.id.substring(0,t.id.lastIndexOf("."))})),l=d3.treemap().size([s,e]).padding(1).round(!0),u=d3.csvParse(t,function(t){var a=t.id.split(".");if(a[1]===firstYear||1==a.length)return{id:t.id,value:+t.value}}),c=i(u).sum(function(t){return t.value}).sort(function(t,a){return a.height-t.height||a.value-t.value});l(c),a(c),switchGunBills(firstYear),$(".year-list li").click(function(){var t=$(this).data("selectedyear");r(t),switchGunBills(t),console.log(t)})}function buildYearChart(t){console.log("--------------   In buildYearChart()  --------------");var a=$("#yearChart").width(),r=500,s=["#88C5F2","#E3C357"],e=d3.select("#yearChart").append("svg").attr("width",a).attr("height",r),n={top:5,right:0,bottom:17,left:25};a=a-n.left-n.right,r=r-n.top-n.bottom,group=e.append("g").attr("transform","translate("+n.left+","+n.top+")");var o=d3.scaleBand().rangeRound([0,a]).padding(.1).align(.1);o.domain(t.map(function(t){return t.Year}));var i=d3.scaleLinear().rangeRound([r,0]);i.domain([0,d3.max(t,function(t){return t.total})]).nice();var l=d3.scaleOrdinal().range([s[0],s[1]]);l.domain(["Gun Control","Gun Rights"]);var u=d3.stack(),c=["Gun Control","Gun Rights"];group.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+r+")").call(d3.axisBottom(o)),group.append("g").attr("class","axis axis--y").call(d3.axisLeft(i).ticks(10,"s").tickSize(a*-1)).append("text").attr("x",2).attr("y",i(i.ticks(10).pop())).attr("dy","0.35em"),group.selectAll(".serie").data(u.keys(c)(t)).enter().append("g").attr("class","serie").attr("fill",function(t){return l(t.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return o(t.data.Year)}).attr("y",function(t){return i(t[1])}).attr("height",function(t){return i(t[0])-i(t[1])}).attr("width",o.bandwidth());var d=group.selectAll(".legend").data(c.reverse()).enter().append("g").attr("class","legend").attr("transform",function(t,a){return"translate(0,"+20*a+")"}).style("font","10px sans-serif");d.append("rect").attr("x",10).attr("y",8).attr("width",18).attr("height",18).attr("fill",l),d.append("text").attr("x",35).attr("y",16).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t})}var firstYear="2013",monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],gunControlGroups=[],gunRightsGroups=[];$(document).ready(function(){$("#hero-gr").hide();var t=$("#hero-gc").height();$("#hero").height(t),$(window).resize(function(){t=$("#hero-gc").height(),$("#hero").height(t)}),$("#button-gc").click(function(){console.log("click"),$(".gr-back").removeClass("gr-back").addClass("gc-back"),$(".gr-dark").removeClass("gr-dark").addClass("gc-dark"),$("#hero-border.gr").removeClass("gr").addClass("gc"),$("#gr-intro").slideUp("slow",function(){$("#gc-intro").slideDown("slow")}),$("#hero-gr").fadeOut(),$("#hero-gc").fadeIn()}),$("#button-gr").click(function(){console.log("click"),$(".gc-back").removeClass("gc-back").addClass("gr-back"),$(".gc-dark").removeClass("gc-dark").addClass("gr-dark"),$("#hero-border.gc").removeClass("gc").addClass("gr"),$("#gc-intro").slideUp("slow",function(){$("#gr-intro").slideDown("slow")}),$("#hero-gc").fadeOut(),$("#hero-gr").fadeIn()}),$(".handle").click(function(){$(this).toggleClass("slideRight"),$(".gun-control").toggleClass("hide-gun-control"),$(".gun-rights").toggleClass("hide-gun-rights")});var a="data/gunOrgSpending.json",r=2e3,s=2016,e={},n={},o=[],l=[];for(i=r;i<=s;i++)$(".year-list").append("<li data-selectedYear="+i+">"+i+"</li>");$.getJSON(a).done(function(t){var a=t.spending[0].gunControl,u=t.spending[1].gunRights;for(i=r;i<=s;i++)$.each(a,function(t,a){$.each(a,function(t,a){o.push(a.name),gunControlGroups.push(a.name)})}),$.each(u,function(t,a){$.each(a,function(t,a){o.push(a.name),gunRightsGroups.push(a.name)})});gunControlGroups=_.uniqBy(gunControlGroups),gunRightsGroups=_.uniqBy(gunRightsGroups),console.log(gunRightsGroups),gunOrgCounts=_.countBy(o);var c=["year"];$.each(gunOrgCounts,function(t,a){c.push(t)});var d=c+"\n",p="id,value\n";for(p+="flare,\n",i=r;i<=s;i++){yearArray=[i.toString()],p+="flare."+i.toString()+",\n";var g=!1,h=!1;$.each(t.spending,function(t,a){0===t&&(group="gc",g||(p+="flare."+i.toString()+"."+group+",\n",$.each(a.gunControl[i.toString()],function(t,a){var r=$.inArray(a.name,c);parseInt(a.expenditures)>0&&(yearArray[r]=a.expenditures),p+="flare."+i.toString()+"."+group+"."+a.name+","+a.expenditures+"\n"}),g=!0))}),$.each(t.spending,function(t,a){1===t&&(group="gr",h||(p+="flare."+i.toString()+"."+group+",\n",$.each(a.gunRights[i.toString()],function(t,a){var r=$.inArray(a.name,c);parseInt(a.expenditures)>0&&(yearArray[r]=a.expenditures),p+="flare."+i.toString()+"."+group+"."+a.name+","+a.expenditures+"\n"}),h=!0))}),d+=yearArray+"\n"}for(i=r;i<=s;i++)mainYear={},mainYear.Year=i,n[i]=0,e[i]=0,u[i.toString()].forEach(function(t){n[i.toString()]+=parseInt(t.expenditures)}),a[i.toString()].forEach(function(t){e[i.toString()]+=parseInt(t.expenditures)}),mainYear["Gun Control"]=e[i.toString()],mainYear["Gun Rights"]=n[i.toString()],mainYear.total=parseInt(e[i.toString()])+parseInt(n[i.toString()]),l.push(mainYear);var m=0,f=0;$.each(l,function(t,a){m+=a["Gun Control"],f+=a["Gun Rights"]}),buildTotalsChart(m,f),buildYearChart(l),buildOrgChart(d),buildTreeChart(p)});var u=new Date,c=u.getFullYear();$(".copyright").text(c)});
//# sourceMappingURL=scripts-bundle.js.map
